# üìö Gi·∫£i th√≠ch chi ti·∫øt c√°c c√¥ng c·ª• v√† th∆∞ vi·ªán trong d·ª± √°n

## **üéØ T·ªïng quan Architecture**

D·ª± √°n n√†y s·ª≠ d·ª•ng m√¥ h√¨nh **MVC (Model-View-Controller)** v·ªõi **TypeScript** v√† **Prisma ORM**:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     VIEW        ‚îÇ    ‚îÇ   CONTROLLER    ‚îÇ    ‚îÇ     MODEL       ‚îÇ
‚îÇ   (EJS Files)   ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ  (Controllers)  ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Services +   ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ                 ‚îÇ    ‚îÇ    Prisma)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚ñ≤                       ‚ñ≤                       ‚ñ≤
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                 ‚ñº
                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                        ‚îÇ     ROUTES      ‚îÇ
                        ‚îÇ  (Express.js)   ‚îÇ
                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## **üõ†Ô∏è Backend Technologies**

### **1. Node.js**

```javascript
// Runtime Environment cho JavaScript
```

- **L√† g√¨:** JavaScript runtime ƒë∆∞·ª£c x√¢y d·ª±ng tr√™n Chrome V8 engine
- **T·∫°i sao d√πng:** Cho ph√©p ch·∫°y JavaScript ·ªü server-side
- **Vai tr√≤:** N·ªÅn t·∫£ng ch·∫°y to√†n b·ªô ·ª©ng d·ª•ng backend
- **∆Øu ƒëi·ªÉm:**
  - Single-threaded v·ªõi event loop (hi·ªáu su·∫•t cao)
  - NPM ecosystem kh·ªïng l·ªì
  - C√πng ng√¥n ng·ªØ v·ªõi frontend (JavaScript/TypeScript)

### **2. TypeScript**

```typescript
// Superset c·ªßa JavaScript v·ªõi static typing
interface User {
  id: number;
  name: string;
  email: string;
}
```

- **L√† g√¨:** Ng√¥n ng·ªØ l·∫≠p tr√¨nh m·ªü r·ªông c·ªßa JavaScript v·ªõi type system
- **T·∫°i sao d√πng:** Gi√∫p catch l·ªói s·ªõm, code d·ªÖ maintain, IntelliSense t·ªët h∆°n
- **Vai tr√≤:** Ng√¥n ng·ªØ ch√≠nh c·ªßa d·ª± √°n
- **Config:** `tsconfig.json` ƒë·ªãnh nghƒ©a c√°ch compile TypeScript ‚Üí JavaScript
- **∆Øu ƒëi·ªÉm:**
  - Type safety (tr√°nh runtime errors)
  - Better IDE support
  - Easier refactoring v√† debugging

### **3. Express.js**

```typescript
import express from "express";
const app = express();
app.get("/", (req, res) => res.send("Hello World"));
```

- **L√† g√¨:** Web framework nh·∫π nh·∫•t cho Node.js
- **T·∫°i sao d√πng:** D·ªÖ setup, flexible, ecosystem m·∫°nh
- **Vai tr√≤:**
  - HTTP server
  - Routing system
  - Middleware management
  - Request/Response handling
- **C√°c t√≠nh nƒÉng s·ª≠ d·ª•ng:**
  - `express.json()`: Parse JSON requests
  - `express.urlencoded()`: Parse form data
  - `express.static()`: Serve static files
  - Router system

---

## **üóÑÔ∏è Database & ORM**

### **4. MySQL**

```sql
-- Relational Database Management System
CREATE TABLE User (
  id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(255),
  email VARCHAR(255),
  address VARCHAR(255)
);
```

- **L√† g√¨:** H·ªá qu·∫£n tr·ªã c∆° s·ªü d·ªØ li·ªáu quan h·ªá (RDBMS)
- **T·∫°i sao d√πng:**
  - Stable, mature
  - ACID compliance
  - Excellent performance
  - Wide industry adoption
- **Vai tr√≤:** L∆∞u tr·ªØ d·ªØ li·ªáu persistent
- **Connection:** Qua `mysql2` package v·ªõi connection pooling

### **5. Prisma ORM**

```typescript
// Modern Database Toolkit
const user = await prisma.user.create({
  data: { name: "John", email: "john@example.com" },
});
```

- **L√† g√¨:** Next-generation ORM cho Node.js & TypeScript
- **T·∫°i sao d√πng thay v√¨ raw SQL:**
  - Type-safe database queries
  - Auto-generated client
  - Database migrations
  - Introspection
  - Better developer experience
- **C√°c components:**
  - **Prisma Schema:** ƒê·ªãnh nghƒ©a data model
  - **Prisma Client:** Auto-generated query builder
  - **Prisma Migrate:** Database migration tool
  - **Prisma Studio:** Database GUI

#### **Prisma Schema Deep Dive:**

```prisma
// File: prisma/schema.prisma

generator client {
  provider = "prisma-client-js"  // T·∫°o JavaScript/TypeScript client
}

datasource db {
  provider = "mysql"             // Database provider
  url      = env("DATABASE_URL") // Connection string t·ª´ .env
}

model User {
  id        Int      @id @default(autoincrement()) // Primary key
  name      String?  @db.VarChar(255)              // Nullable field
  email     String?  @db.VarChar(255)
  address   String?  @db.VarChar(255)
}
```

### **6. mysql2**

```typescript
import mysql from "mysql2/promise";
const connection = await mysql.createConnection({
  host: "localhost",
  port: 3306, // MySQL connection config
});
```

- **L√† g√¨:** MySQL client cho Node.js (successor c·ªßa mysql package)
- **T·∫°i sao d√πng:** Promise support, better performance, maintained actively
- **Vai tr√≤:** Low-level database connection (backup cho Prisma)
- **Features:**
  - Promise-based API
  - Connection pooling
  - Prepared statements
  - Better security

---

## **üé® Frontend & Templating**

### **7. EJS (Embedded JavaScript)**

```html
<!-- Server-side templating -->
<h1>Hello <%= user.name %>!</h1>
<% if (users.length > 0) { %> <% users.forEach(user => { %>
<p><%= user.email %></p>
<% }) %> <% } %>
```

- **L√† g√¨:** Template engine cho Node.js
- **T·∫°i sao d√πng:**
  - Simple syntax (gi·ªëng HTML + JavaScript)
  - Server-side rendering
  - SEO friendly
  - No complex build process
- **Vai tr√≤:** Generate dynamic HTML pages
- **Syntax:**
  - `<%= %>`: Output escaped value
  - `<%- %>`: Output unescaped value
  - `<% %>`: Control flow (if, for, etc.)

### **8. Bootstrap 5**

```html
<!-- CSS Framework -->
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<div class="container mt-5">
  <button class="btn btn-primary">Click me</button>
</div>
```

- **L√† g√¨:** CSS framework cho responsive design
- **T·∫°i sao d√πng:**
  - Rapid prototyping
  - Responsive grid system
  - Pre-built components
  - Consistent design
- **Vai tr√≤:** Styling v√† layout cho UI
- **Components s·ª≠ d·ª•ng:**
  - Grid system (`container`, `row`, `col`)
  - Forms (`form-control`, `form-label`)
  - Buttons (`btn`, `btn-primary`)
  - Tables (`table`, `table-striped`)

---

## **‚öôÔ∏è Development Tools**

### **9. Nodemon**

```json
// Auto-restart server khi code thay ƒë·ªïi
{
  "nodemonConfig": {
    "watch": ["src"],
    "ext": "ts",
    "exec": "ts-node -r tsconfig-paths/register src/app.ts"
  }
}
```

- **L√† g√¨:** Utility t·ª± ƒë·ªông restart Node.js application
- **T·∫°i sao d√πng:** TƒÉng productivity trong development
- **Vai tr√≤:** Development server v·ªõi hot-reload
- **Config:** Watch `src` folder, restart khi `.ts` files thay ƒë·ªïi

### **10. ts-node**

```bash
# Ch·∫°y TypeScript tr·ª±c ti·∫øp m√† kh√¥ng c·∫ßn compile
ts-node src/app.ts
```

- **L√† g√¨:** TypeScript execution engine cho Node.js
- **T·∫°i sao d√πng:** Run TypeScript code tr·ª±c ti·∫øp, kh√¥ng c·∫ßn build step
- **Vai tr√≤:** Development runtime cho TypeScript
- **Features:**
  - JIT compilation
  - Source map support
  - REPL support

### **11. tsconfig-paths**

```typescript
// Cho ph√©p s·ª≠ d·ª•ng path mapping
import { getUsers } from "@services/user-service";
// Thay v√¨: import { getUsers } from '../../../services/user-service';
```

- **L√† g√¨:** Resolve TypeScript path mapping t·∫°i runtime
- **T·∫°i sao d√πng:** Clean imports, easier refactoring
- **Vai tr√≤:** Module resolution v·ªõi custom paths
- **Config trong tsconfig.json:**

```json
{
  "baseUrl": ".",
  "paths": {
    "@services/*": ["./src/services/*"],
    "@controllers/*": ["./src/controllers/*"]
  }
}
```

---

## **üîß Environment & Configuration**

### **12. dotenv**

```typescript
// Load environment variables t·ª´ .env file
import "dotenv/config";
const dbUrl = process.env.DATABASE_URL;
```

- **L√† g√¨:** Load environment variables t·ª´ `.env` file
- **T·∫°i sao d√πng:**
  - Keep secrets out of code
  - Different configs cho different environments
  - Security best practice
- **Vai tr√≤:** Configuration management
- **Usage:**

```env
NODE_ENV=development
DATABASE_URL=mysql://user:pass@localhost:3306/db
```

### **13. Environment Variables**

```env
# .env file structure
NODE_ENV=development          # Environment type
DB_HOST=localhost            # Database host
DB_PORT=3306                 # Database port
DB_USER=root                 # Database username
DB_PASSWORD=your_password    # Database password
DB_DATABASE=nodejshit        # Database name
DATABASE_URL=mysql://...     # Full connection string
```

- **NODE_ENV:** X√°c ƒë·ªãnh environment (development/production/test)
- **DB\_\* variables:** Database connection parameters
- **DATABASE_URL:** Prisma connection string

---

## **üìÅ Project Structure Deep Dive**

```
src/
‚îú‚îÄ‚îÄ app.ts                 # Entry point - Express server setup
‚îú‚îÄ‚îÄ config/               # Configuration files
‚îÇ   ‚îú‚îÄ‚îÄ client.ts         # Prisma client singleton
‚îÇ   ‚îî‚îÄ‚îÄ database.ts       # MySQL connection (fallback)
‚îú‚îÄ‚îÄ controllers/          # Route handlers (Controller layer)
‚îÇ   ‚îî‚îÄ‚îÄ users.controller.ts
‚îú‚îÄ‚îÄ routers/             # Route definitions
‚îÇ   ‚îî‚îÄ‚îÄ web.ts           # Web routes
‚îú‚îÄ‚îÄ services/            # Business logic (Model layer)
‚îÇ   ‚îî‚îÄ‚îÄ user-service.ts  # User CRUD operations
‚îî‚îÄ‚îÄ views/               # EJS templates (View layer)
    ‚îú‚îÄ‚îÄ home.ejs
    ‚îú‚îÄ‚îÄ create-user.ejs
    ‚îî‚îÄ‚îÄ view-user.ejs

prisma/
‚îú‚îÄ‚îÄ schema.prisma        # Database schema definition
‚îî‚îÄ‚îÄ migrations/          # Database migration files

public/                  # Static assets
‚îú‚îÄ‚îÄ css/
‚îú‚îÄ‚îÄ images/
‚îî‚îÄ‚îÄ javascript/

dist/                   # Compiled JavaScript output
```

### **Layer Responsibilities:**

1. **Controllers:** Handle HTTP requests/responses
2. **Services:** Business logic v√† database operations
3. **Views:** HTML templates v·ªõi dynamic content
4. **Routes:** URL mapping t·ªõi controllers
5. **Config:** Database connections v√† app configuration

---

## **üîÑ Request Flow**

```
Browser Request
      ‚Üì
Express Router (web.ts)
      ‚Üì
Controller (users.controller.ts)
      ‚Üì
Service (user-service.ts)
      ‚Üì
Prisma Client
      ‚Üì
MySQL Database
      ‚Üì
Response back through same chain
      ‚Üì
EJS Template Rendering
      ‚Üì
HTML Response to Browser
```

### **Example Flow - T·∫°o User:**

1. **Browser:** POST `/create-user` v·ªõi form data
2. **Router:** Route t·ªõi `postCreateUserPage` controller
3. **Controller:** Extract data t·ª´ `req.body`
4. **Service:** `handleCreateUser()` g·ªçi Prisma
5. **Prisma:** Generate SQL INSERT query
6. **MySQL:** Execute query, return new user
7. **Response:** Redirect v·ªÅ homepage
8. **Homepage:** Load users v√† render v·ªõi EJS

---

## **üöÄ Build & Deployment Process**

### **Development:**

```bash
npm run dev
# 1. Nodemon watches src/
# 2. ts-node compiles TypeScript on-the-fly
# 3. Server starts v·ªõi hot-reload
```

### **Production:**

```bash
npm run build  # TypeScript ‚Üí JavaScript (dist/)
npm start      # Run compiled JavaScript
```

### **Database Operations:**

```bash
npx prisma migrate dev    # Apply schema changes
npx prisma generate      # Regenerate Prisma client
npx prisma studio        # Open database GUI
```

---

## **üí° Key Benefits c·ªßa Tech Stack n√†y**

### **Type Safety:**

- TypeScript + Prisma = End-to-end type safety
- Database schema ‚Üí TypeScript types t·ª± ƒë·ªông

### **Developer Experience:**

- Hot reload v·ªõi nodemon
- IntelliSense v·ªõi TypeScript
- Path mapping cho clean imports
- Database GUI v·ªõi Prisma Studio

### **Performance:**

- Prisma query optimization
- Connection pooling
- Single-threaded Node.js event loop

### **Maintainability:**

- Clear separation of concerns (MVC)
- Type safety gi·∫£m bugs
- Database migrations cho consistency
- Environment-based configuration

---

## **üîç Debugging & Monitoring**

### **Debug Configuration:**

```json
// VS Code launch.json
{
  "name": "debug-nodejshd",
  "type": "node",
  "request": "launch",
  "runtimeExecutable": "npm",
  "runtimeArgs": ["run", "start:debug"]
}
```

### **Debug Features:**

- **Breakpoints:** Set trong VS Code
- **Inspector:** `--inspect=9229` flag
- **Source Maps:** TypeScript debugging trong browser
- **Console logging:** `console.log()` statements

---

**üéØ K·∫øt lu·∫≠n:** ƒê√¢y l√† tech stack modern, type-safe, developer-friendly cho web applications. M·ªói tool ƒë∆∞·ª£c ch·ªçn c√≥ l√Ω do c·ª• th·ªÉ v√† work together t·∫°o n√™n development experience tuy·ªát v·ªùi.
